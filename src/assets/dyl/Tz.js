"use strict";var getNowTime=function(){let e=new Date;return[e.getSeconds(),e.getMilliseconds()]};window.tz=function(e,...t){let n="",r=[],o=[],c=-1,l=function(e){return function(){return"del"===c||e.apply(this,arguments)}},f=null;"object"==typeof e&&e.getChildren?f=e:(f=cc.director.getScene().getChildren()[0],t=[e,...t]);let i=[],u=null,s=null,a=function(){};o.push(a);let p=function(e){let t=a;a=l(a=function(){r=[];let n=e.length+1,o=function(){--n||t()};for(let t=e.length-1;t>=0;t--){let n=e[t];if("number"==typeof n)return cc.error("tz \u540c\u6b65\u52a8\u4f5c\u4e0d\u80fd\u63a5\u53d7 \u5faa\u73af\u64cd\u4f5c");if("function"==typeof n){if(n.actArr)for(let e=0;e<n.actArr.length;e++){let t=n.actArr[e];r.push({node:t.node,act:t})}let e=l(o);n(e)||e();continue}let c=cc.callFunc(o),f=cc.sequence(n,c);n.node.active||cc.warn("\u8fd9\u4e2a\u8282\u70b9 active \u4e3a false","sameArr"),r.push({node:n.node,act:f}),n.node.runAction(f)}o()})},y=function(){if(u)return cc.error("\u540c\u65f6\u8fd0\u884c\u7684\u52a8\u4f5c\uff0c\u6ca1\u6709\u7ed3\u675f");if("number"==typeof i[0])return cc.error("tz \u4e00\u5f00\u59cb\u4e0d\u80fd\u662f\u5faa\u73af\u6570\uff0c\u56e0\u4e3a\u6ca1\u6709\u52a8\u4f5c\u53ef\u4ee5\u5faa\u73af");"number"!=typeof i[i.length-1]&&i.push(1);for(let e=i.length-1;e>=0;e--){let t=i[e];if(Array.isArray(t)){p(t);continue}let n=a;if("function"==typeof t){a=l(()=>{if(r=[],t.actArr)for(let e=0;e<t.actArr.length;e++){let n=t.actArr[e];r.push({node:n.node,act:n})}t(n)||n()});continue}if("number"==typeof t){if("number"==typeof i[e-1])return cc.warn("tz \u8fde\u7eed\u8fd9\u91cc\u6709\u4e00\u4e2a\u5faa\u73af\u4f53\u4e3a\u7a7a\uff0c\u5c31\u662f\u8fde\u7eed\u4e24\u4e2a\u53c2\u6570\u4e3a\u8d1f\u6570");let n=o.length;o[n-1].oriEndFun=a;let c=t;a=(()=>{r=[],c--?o[n].oriEndFun():o[n-1]()}),o.push(a);continue}let c=cc.callFunc(function(){n()}),f=cc.sequence(t,c);a=l(a=function(){r=[{node:t.node,act:f}],t.node.active||cc.warn("\u8fd9\u4e2a\u8282\u70b9 active \u4e3a false",t.actName),t.node.runAction(f)})}o[o.length-1].oriEndFun=a,o[o.length-1]()},d=function(e){let t=null;if(Array.isArray(e)){let t=e;e=function(){let e=[],n=function(t,n){for(let r=e.length-1;r>=0;r--)e[r][t]=n},r=function(t){for(let n=e.length-1;n>=0;n--){let r=!0===t.x?e[n].x:t.x,o=!0===t.y?e[n].y:t.y;e[n].setPosition(r,o)}};for(let o=0;o<t.length;o++){let c=t[o],l=null;if(l=c&&"object"==typeof c&&!c.getChildren&&void 0!==c.x&&void 0!==c.y?"cc.Vec2":cc.js.getClassName(c),Array.isArray(c))c.length<1&&(e=c),"number"==typeof c[0]?1===c.length?n("rotate",c):n("scale",cc.v2(c[0],c[1])):e=c;else if("cc.Node"===l)e=[c];else if("boolean"==typeof c)n("active",c);else if("cc.Color"===l)n("color",c);else if("cc.Vec2"===l)r(c);else if("number"==typeof c)n("opacity",c);else{if("string"!=typeof c)return cc.error("\u5b8c\u5168\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406",c);if("function"==typeof e[0][c])if(Array.isArray(t[o+1])){o++;for(let n=0;n<e.length;n++)e[n][c](...t[o])}else for(let t=0;t<e.length;t++)e[t][c]();else n(c,t[++o])}}}}if("string"==typeof e){let t=e;""===n&&(n=t+" "),e=function(){cc.log(t)}}if("function"==typeof e){t=(t=>e(t))}else"number"==typeof e?t=e<0?-e:isNaN(e)?-1:cc.delayTime(e):cc.error("\u53c2\u6570\u6709\u95ee\u9898,\u8fd9\u91cc\u4e0d\u63a5\u53d7\u5176\u4ed6\u53c2\u6570",e);return"function"==typeof t?(t.node=f,t.actName="function"):"number"!=typeof t&&(t.node=f,t.actName=e),t},g=function(...e){if(void 0===e[0])return-1!==c?cc.warn("tz \u5df2\u7ecf\u8fd0\u884c\u8fc7\u4e86\uff0c\u4e0d\u80fd\u518d\u7528\u4e86"):(c=!1,y(),s);if(null===e[0]){if(-1===c)return cc.warn("tz \u8fd8\u6ca1\u6709\u5efa\u7acb\u8fd0\u884c"),s;if(c="del",0===r.length)return s;for(var t=r.length-1;t>=0;t--)r[t].node.stopAction(r[t].act);return s}if("boolean"==typeof e[0]){if(-1===c)return cc.warn("tz \u8fd8\u6ca1\u6709\u5efa\u7acb\u8fd0\u884c"),s;if("del"===c)return cc.warn("tz \u6240\u6709\u52a8\u4f5c\u90fd\u5220\u9664\u4e86\uff0c\u6ca1\u5fc5\u8981\u6682\u505c\u548c\u6062\u590d\u4e86"),s;if(0===r.length)return cc.warn("tz \u8fd9\u91cc\u6ca1\u6709\u8981\u6682\u505c\u7684\u52a8\u4f5c\u8868\uff0c\u662f\u5426\u90fd\u662f\u51fd\u6570\uff1f"),s;if(e[0]){if(!c)return s;for(t=r.length-1;t>=0;t--)r[t].node.resumeAllActions();c=!1}else{if(c)return s;for(t=r.length-1;t>=0;t--)r[t].node.pauseAllActions();c=!0}return s}for(let t=0;t<e.length;t++){let n=e[t],r=d(n);u?u.push(r):i.push(r)}return s};for(let e=0;e<t.length;e++)void 0!==t[e]&&g(t[e]);return s=new Proxy(g,{get:function(e,t){let n=!1;"_"===t[0]&&(n=!0);let r=t.split("_").pop();return function(e,...t){let o=null;if(""===r)void 0===e&&(e=0),(o=d(e,...t)).actName=e;else if("to"===r||"by"===r){let n=null,l=t[t.length-1];"object"==typeof l&&"function"==typeof l.easing&&"function"==typeof l.reverse&&(t.pop(),n=l),t=[e,...t];let i=0,u=null,s=[],a=[],p=[],y=[];if(Array.isArray(t[0])&&t[0].length<1)(o=function(){}).actName=r;else{Array.isArray(t[i])?"function"==typeof t[i][0].getChildren&&(u=t[i],i++):"function"==typeof t[i].getChildren&&(u=[t[i]],i++),u||(u=[f]),Array.isArray(t[i])&&(a=t[i],i++);let e=0,l=0,d=0,g={pos:null,diff_pos:cc.v2(0,0),now_diff_pos:cc.v2(0,0),rotate:null,diff_rotate:0,now_diff_rotate:0,scale:null,diff_scale:[0,0],now_diff_scale:[0,0],color:null,diff_color:cc.color(0,0,0),now_diff_color:cc.color(0,0,0)};for(;i<t.length;i++){var c=t[i];if("number"==typeof c)e=c;else if("function"==typeof c)p.push(c);else if(Array.isArray(c))1===c.length?g.rotate=c[0]:g.scale=c;else if(c&&"object"==typeof c&&!c.getChildren&&void 0!==c.x&&void 0!==c.y)!0===c.x?c.x=u[0].x:!0===c.y&&(c.y=u[0].y),g.pos=c;else{if("cc.Color"!==cc.js.getClassName(c))return cc.error("tz \u8fd9\u4e2a\u7c7b\u578b\u6211\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406",c);g.color=c}}for(i=0;i<a.length;i++)if("number"==typeof a[i])l=a[i],d=l<0?-l*u.length:-l;else if("function"==typeof a[i])y.push(a[i]);else if(Array.isArray(a[i])){if(1===a[i].length){if(g.diff_rotate=a[i][0],null===g.rotate)return cc.error("tz \u6709\u504f\u79fb\u900f\u660e\u5ea6\uff0c\u4f46\u6ca1\u6709\u56fa\u5b9a\u900f\u660e\u5ea6\u8d4b\u503c [number]")}else if(g.diff_scale=a[i],null===g.scale)return cc.error("tz \u6709\u504f\u79fb\u7f29\u653e\uff0c\u4f46\u6ca1\u6709\u56fa\u5b9a\u7f29\u653e\u8d4b\u503c [number, number]")}else if("cc.Vec2"===cc.js.getClassName(a[i])){if(g.diff_pos=a[i],null===g.pos)return cc.error("tz \u6709\u504f\u79fb\u4f4d\u7f6e, \u4f46\u6ca1\u6709\u56fa\u5b9a\u4f4d\u7f6e")}else{if("cc.Color"!==cc.js.getClassName(a[i]))return cc.error("tz \u8fd9\u4e2a\u7c7b\u578b\u6211\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406",a[i]);if(g.diff_color=a[i],null===g.color)return cc.error("tz \u6709\u504f\u79fb\u989c\u8272, \u4f46\u6ca1\u6709\u56fa\u5b9a\u989c\u8272")}let h=0,m=null,b=function(e){h=e},A=function(){0==--h&&m()},_=function(e,t,r){let o=cc.callFunc(A);n&&e.easing(n);let c=null;if(r>1e-6){let t=cc.delayTime(r);c=cc.sequence(t,e,o)}else c=cc.sequence(e,o);c.node=t,s.push(c)},v=function(e,t,n){let r={};for(let o=0;o<t.length;o++){let c=t[o](e,n);"number"==typeof c?r.time=c:Array.isArray(c)?1===c.length?r.rotate=c[0]:r.scale=c:"cc.Vec2"===cc.js.getClassName(c)?r.pos=c:"cc.Color"===cc.js.getClassName(c)&&(r.color=c)}return r};if("to"===r)for(i=0;i<u.length;i++){let t=u[i],n=v(i,p,t),r=v(i,y,t),o=e;"number"==typeof n.time&&(o=n.time),"number"==typeof r.time?d=r.time:d+=l;let c=function(e,t){return"pos"===e?cc.moveTo(o,t):"rotate"===e?cc.rotateTo(o,t):"scale"===e?cc.scaleTo(o,t[0],t[1]):"color"===e?cc.tintTo(o,t.r,t.g,t.b):void 0},f=function(e){if("pos"===e)g.pos=g.pos.add(g.diff_pos);else if("rotate"===e)g.rotate+=g.diff_rotate;else if("scale"===e){let[e,t]=g.scale,[n,r]=g.diff_scale;g.scale=[e+n,t+r]}else if("color"===e){let{r:e,g:t,b:n}=g.diff_color;g.color=cc.color(g.color.r+e,g.color.g+t,g.color.b+n)}},s=function(e){if(r[e]&&(g["diff_"+e]=r[e]),n[e]){let r=c(e,n[e]);_(r,t,d),null!==g[e]&&(g[e]=n[e],f(e))}else if(null!==g[e]){let n=c(e,g[e]);_(n,t,d),f(e)}};s("pos"),s("rotate"),s("scale"),s("color")}else if("by"===r)for(i=0;i<u.length;i++){let t=u[i],n=v(i,p,t),r=v(i,y,t),o=e;"number"==typeof n.time&&(o=n.time),"number"==typeof r.time?d=r.time:d+=l;let c=function(e,t){return"pos"===e?cc.moveBy(o,t):"rotate"===e?cc.rotateBy(o,t):"scale"===e?cc.scaleBy(o,t[0],t[1]):"color"===e?cc.tintBy(o,t.r,t.g,t.b):void 0},f=function(e,t,n){if("pos"===e)return t.add(n);if("rotate"===e)return t+n;if("scale"===e){let[e,r]=t,[o,c]=n;return[e+o,r+c]}if("color"===e){let{r:e,g:r,b:o}=t;return cc.color(n.r+e,n.g+r,n.b+o)}},s=function(e){g["now_diff_"+e]=f(e,g["now_diff_"+e],g["diff_"+e])},a=function(e){if(r[e]&&(g["diff_"+e]=r[e]),n[e]){let r=c(e,n[e]);_(r,t,d),null!==g[e]&&(g[e]=n[e])}else if(null!==g[e]){let n=c(e,f(e,g[e],g["now_diff_"+e]));_(n,t,d),s(e)}};a("pos"),a("rotate"),a("scale"),a("color")}else cc.error("tz \u8fd9\u4e2aactName\u7a81\u7136\u53d8\u5f97\u597d\u5947\u602a\uff0c\u4e0d\u662fto\u4e5f\u4e0d\u662fby",r);let w=function(e){m=e,b(s.length+1);for(let e=0;e<s.length;e++){if(!s[e].node.active)return cc.warn(r+"\u5b58\u5728\u8282\u70b9\u7684active\u4e3a\u5426",s[e].node);s[e].node.runAction(s[e])}return A(),!0};w.actName=r,w.actArr=s,o=w}}else{"object"==typeof e&&e.getChildren||(t=[e,...t],e=f);let n=null,c=t[t.length-1];"object"==typeof c&&"function"==typeof c.easing&&"function"==typeof c.reverse&&(t.pop(),n=c),(o=cc[r](...t)).node=e,o.actName=r,n&&o.easing(n)}return n?u?(u.push(o),i.push(u),u=null):u=[o]:u?u.push(o):i.push(o),s}}})};